angular.module("mainModule",["gettext","ui.router","angularMoment","ngMaterial","md.data.table","angular-loading-bar","templates","angular-cache","duScroll","ngFileUpload","vcRecaptcha","ngFileSaver"]).value("duScrollDuration",3e3).constant("_",window._).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(e,t,n,r){r.html5Mode(!0),e.state("cheque",{abstract:!0,url:"/cheques",views:{header:{controller:["$rootScope","$scope","$state",function(e,a,t){a.selectedTab=t.current.data.selectedTab,e.$on("$stateChangeSuccess",function(e,t,n,r,o){a.selectedTab=t.data.selectedTab})}],template:'<header selected-tab="selectedTab"></header>'},content:{template:"<ui-view></ui-view>"}}}).state("cheque.filter",{url:"^/filter",template:"<filters-page></filters-page>",data:{selectedTab:0}}).state("cheque.edit",{url:"^/cheque/{chequeId:[0-9]{1,10}}",controller:["$scope","$stateParams",function(e,t){e.chequeID=t.chequeId}],template:'<cheque-page cheque-id="chequeID"></cheque-page>',data:{selectedTab:1}}).state("cheque.create",{url:"^/cheque",template:"<cheque-page></cheque-page>",data:{selectedTab:1}}).state("cheque.profile",{url:"^/profile",template:"<profile-page></profile-page>",data:{selectedTab:4,access:["ROLE_ADMIN"]}}).state("cheque.login",{url:"^/login",template:"<login-page></login-page>",data:{selectedTab:5}}),n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",n.interceptors.push(["$q","$injector","$rootScope","_",function(r,o,a,i){return{responseError:function(e){var t,n;return-1===e.status?(o.get("warning").showServerConnectionLostException(),r.reject(e)):403===e.status?(t=o.get("$http"),n=r.defer(),t.get("/api/test").then(n.resolve,n.reject),n.promise.then(function(){return t(e.config)})):(401!==e.status||i.isEmpty(a.user)?"org.springframework.orm.ObjectOptimisticLockingFailureException"!==e.data.exception||o.get("warning").showAlertOptimisticLockingException():o.get("warning").showServerSessionExpired(),r.reject(e))}}}])}]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("grey",{default:"900"}).accentPalette("blue-grey",{default:"900"}),e.theme("inner-block").primaryPalette("grey",{default:"50"}),e.theme("header").primaryPalette("grey",{default:"50"}).accentPalette("blue-grey",{default:"50"}).dark()}]).config(["cfpLoadingBarProvider",function(e){e.includeSpinner=!1,e.latencyThreshold=100}]).config(["$mdDateLocaleProvider",function(e){e.months="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),e.shortMonths="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),e.days="Monday_Tuesday_Wednesday_Thursday_Friday_Saturday_Sunday".split("_"),e.shortDays="Mon_Tue_Wed_Thu_Fri_Sat_Sun".split("_"),e.firstDayOfWeek=1,e.formatDate=function(e){return e?moment(e).format("DD.MM.YYYY"):""},e.parseDate=function(e){e=moment(e,"DD.MM.YYYY",!0);return e.isValid()?e.toDate():new Date(NaN)}}]).run(["gettextCatalog","amMoment","auth","security","autocomplete","$rootScope",function(e,t,n,r,o,a){n.init(),r.init(),e.setCurrentLanguage("en"),t.changeLocale("en"),a.tableFilter={sort:"-id",size:15,page:1}}]),angular.module("mainModule").controller("ChequePage",["$rootScope","$scope","$stateParams","$http","cheque","warning","$state",function(e,a,t,n,r,i,c){a.formDirty={payment:!1,cheque:!1,comments:!1},a.hasID=!!a.chequeID,a.printable=!1,a.hasID?(r.getChequeFromServer(a.chequeID),r.getChequeBalanceFromServer(a.chequeID),r.getPhotoListFromServer(a.chequeID)):r.createNewCheque(),a.$watch("cheque.id",function(e,t){a.hasID=!!e}),e.$watch("cheque",function(e,t){a.cheque=e,a.chequeID=e.id,a.hasID=!!e.id}),e.$on("$stateChangeStart",function(e,t,n,r,o){"cheque.edit"!==r.name&&"cheque.create"!==r.name||!(a.formDirty.cheque||a.formDirty.payment||a.formDirty.comments)||(e.preventDefault(),i.showConfirmUnsavedChanges().then(function(){a.formDirty={payment:!1,cheque:!1,comments:!1},c.go(t)},function(){}))})}]).directive("chequePage",function(){return{restrict:"E",controller:"ChequePage",scope:{chequeID:"=?chequeId"},templateUrl:"app/cheque-page/cheque-page.html"}}),angular.module("mainModule").directive("filtersPage",function(){return{restrict:"E",templateUrl:"app/filters-page/filters-page.html"}}),angular.module("mainModule").controller("Header",["$scope","currencyRatesService","$mdToast","$rootScope","auth","gettextCatalog","security",function(e,t,n,r,o,a,i){t.getCurrencyRate(),e.refreshCurrencyRates=function(){t.refreshCurrencyRate(),n.show(n.simple().content("Currency rates refreshed").position("top right").hideDelay(700))},e.authenticated=function(){return o.authenticated},e.profileName=function(){return r.user.principal&&r.user.principal.fullname?r.user.principal.fullname:a.getString("profile")},e.security=i,e.logout=o.logout}]).directive("header",function(){return{restrict:"E",controller:"Header",scope:{selectedTab:"=selectedTab"},require:"selectedTab",templateUrl:"app/header/header.html"}}),angular.module("mainModule").controller("LoginPage",["$scope","$rootScope","auth","$mdToast","vcRecaptchaService","autocomplete",function(r,e,t,n,o,a){r.credentials={},r.response=null,r.widgetId=null,r.model={key:"6Le_FBETAAAAABTCTvoZWEEIqb1lxqNpNAtRlGWk"},r.authenticated=function(){return t.authenticated},r.login=function(){t.authenticate(r.credentials,r.response).then(function(e){e?n.show(n.simple().content("Login succeeded").position("top right").hideDelay(700)):(n.show(n.simple().content("Login failed").position("top right").hideDelay(700)),o.reload(r.widgetId))})},r.logout=t.logout,r.hasAccess=function(t){var n=!1;return angular.forEach(e.user.authorities,function(e){e.authority===t&&(n=!0)}),n&&r.authenticated()},r.setResponse=function(e){r.response=e},r.setWidgetId=function(e){r.widgetId=e},r.cbExpiration=function(){r.response=null}}]).directive("loginPage",function(){return{restrict:"E",controller:"LoginPage",templateUrl:"app/login-page/login-page.html"}}),angular.module("mainModule").controller("ProfilePage",["$scope","$http","currencyRatesService",function(t,e,n){var r={username:"Name",fullname:"FullName",enabled:!0,authorities:[{authority:"ROLE_ENGINEER"}]};n.getListOfCurrencyRates().then(function(e){t.rates=e}),t.setRates=function(){n.setListOfCurrencyRates(t.rates)},t.getUsers=function(){e.get("/api/users").success(function(e){t.users=e})},t.addUser=function(){t.users.push(r)},t.getUsers()}]).directive("profilePage",function(){return{restrict:"E",controller:"ProfilePage",templateUrl:"app/profile-page/profile-page.html"}}),angular.module("mainModule").controller("ChequeForm",["$scope","$http","gettextCatalog","$mdToast","$state","security","$rootScope","warning","$document","cheque","autocomplete","$timeout",function(n,e,t,s,l,r,o,a,m,i,c,u){n.disableChequeForm=!r.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS","ROLE_SECRETARY"]),n.security=r,n.getAutocompleteData=c.getAutocompleteData,n.currentDateIfEmpty=i.addToChequeCurrentDateIfEmpty,n.cleanDateIfOff=i.cleanDateIfOff,n.users=[],n.getUsers=function(){c.getUsers().then(function(e){n.users=e})},n.getUsers(),n.syncCheque=function(){i.syncChequeWithServer(n.cheque).then(function(e){e&&(n.chequeForm.$setPristine(),n.chequeForm.$setUntouched(),i.getChequeBalanceFromServer(o.cheque.id))})},n.deleteCheque=function(e){a.showConfirmDeleteCheque(e).then(function(){n.$parent.formDirty={payment:!1,cheque:!1},i.deleteChequeFromServer(n.cheque.id)},function(){})},n.addKit=function(e){return{name:e}},n.syncWithReadyStatus=function(){n.cheque.readyStatus=n.cheque.withoutRepair,n.currentDateIfEmpty("readyDate","readyStatus")},n.syncWithWithoutRepairStatus=function(){var e=n.cheque.readyStatus,t=n.cheque.withoutRepair;!1===e&&!0===t&&(n.cheque.withoutRepair=e)},n.printCheque=function(){n.printable=!0,u(function(){window.print()},0)},u(function(){n.chequeForm.$setPristine(),n.$watch("chequeForm.$dirty",function(e,t){n.$parent.formDirty.cheque=e})},1e3)}]).directive("chequeForm",[function(){return{restrict:"E",controller:"ChequeForm",scope:{cheque:"=ngModel",hasID:"=hasId",printable:"=printable"},require:["ngModel","hasId"],templateUrl:"app/cheque-page/cheque-form/cheque-form.html"}}]),angular.module("mainModule").controller("CommentsBlock",["$scope","$http","$document","$rootScope","security","warning","cheque","$timeout",function(n,r,e,t,o,a,i,c){n.comment=void 0,n.add=3,n.limit=3,n.bottomButton="show more",n.security=o,n.saveComment=function(){n.comment.user=t.user.principal,n.comment.cheque=n.cheque,r.post("/api/cheques/"+n.cheque.id+"/"+n.type,n.comment).success(function(){n.comment.text=void 0,n.commentsForm.$setPristine(),n.commentsForm.$setUntouched(),"diagnostics"===n.type&&i.getDiagnosticsFromServer(n.cheque.id),"notes"===n.type&&i.getNotesFromServer(n.cheque.id)})},n.deleteComment=function(e,t){a.showConfirmDeleteComment(t).then(function(){r.delete("/api/cheques/"+n.cheque.id+"/"+n.type+"/"+e).success(function(){"diagnostics"===n.type&&i.getDiagnosticsFromServer(n.cheque.id),"notes"===n.type&&i.getNotesFromServer(n.cheque.id)})},function(){})},n.addedLesserThanElem=function(){if(n.cheque[n.type])return n.add<n.cheque[n.type].length};function u(){return n.limit<n.cheque[n.type].length}n.limitComments=function(){u()?n.limit+=n.add:n.limit=n.add,u()?n.bottomButton="show more":n.bottomButton="roll up"},c(function(){n.commentsForm.$setPristine(),n.$watch("commentsForm.$dirty",function(e,t){n.$parent.formDirty.comments=e})},1e3)}]).directive("commentsBlock",[function(){return{restrict:"E",controller:"CommentsBlock",scope:{cheque:"=ngModel",type:"=type"},require:"ngModel",templateUrl:"app/cheque-page/comments-block/comments-block.html"}}]),angular.module("mainModule").controller("PaymentBlock",["$rootScope","$scope","currencyRatesService","security","warning","$http","$mdToast","gettextCatalog","cheque","$state","$timeout",function(e,o,t,n,r,a,i,s,c,l,u){o.hasPrepayment=!1,o.balance={payments:[]},o.security=n,o.hasAtLeastOnePayment=function(){return 0<o.balance.payments.length},o.synchronizeBalance=function(){c.syncChequeBalanceWithServer(o.chequeID,o.balance).then(function(e){e&&(o.paymentForm.$setPristine(),o.paymentForm.$setUntouched())})},o.addPayment=function(){void 0===o.balance.payments&&(o.balance.payments=[]),t.refreshCurrencyRate(),o.balance.payments.push({cost:0,type:"repair",currency:"rub",exchangeRate:e.currencyRates,user:e.user.principal})},o.delPayment=function(e,t){r.showConfirmDeletePayment(t).then(function(){o.balance.payments.splice(o.balance.payments.indexOf(e),1),o.paymentForm.$setDirty()},function(){})},o.sum=function(t,n){var r=0;return o.hasPrepayment=!1,null!=o.balance.payments&&o.balance.payments.forEach(function(e){null!=e.cost&&null!=e.currency&&("prepayment"!=e.type?r+=e.cost*e.exchangeRate[e.currency]/e.exchangeRate[t]:(o.hasPrepayment=!0,n&&(r-=e.cost*e.exchangeRate[e.currency]/e.exchangeRate[t])))}),r},e.$watch("balance",function(e,t){void 0!==e&&(o.balance=e),u(function(){null!=o.paymentForm&&(o.paymentForm.$setPristine(),o.paymentForm.$setUntouched())},500)}),u(function(){o.$watch("paymentForm.$dirty",function(e,t){o.$parent.formDirty.payment=e})},1e3)}]).directive("paymentBlock",[function(){return{restrict:"E",controller:"PaymentBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/payment-block/payment-block.html"}}]),angular.module("mainModule").directive("printCheque",function(){return{restrict:"E",controller:["$scope",function(e){e.spec={office:{office:!0,tech:!1,client:!1},tech:{office:!1,tech:!0,client:!1},client:{office:!1,tech:!1,client:!0}}[e.specialization],e.getComponents=function(){var t=[];return e.cheque.components.forEach(function(e){t.push(e.name)}),t.join(", ")}}],scope:{cheque:"=ngModel",specialization:"=specialization"},require:["ngModel","specialization"],templateUrl:"app/cheque-page/print-cheque/print-cheque.html"}}),angular.module("mainModule").controller("PhotoBlock",["$scope","Upload","$http","$state","$location","$rootScope","warning","cheque","$window","security",function(r,o,n,e,s,a,i,c,t,u){r.security=u,r.deletePhoto=function(e,t){i.showConfirmDeletePhoto(t).then(function(){n.delete("api/photo/"+r.chequeID+"/"+e).success(function(){c.getPhotoListFromServer(r.chequeID)})},function(){})},r.openPhoto=function(e){t.open("/api/photo/"+e,"_blank")},r.$watch("files",function(){r.upload(r.files)}),r.$watch("file",function(){null!=r.file&&(r.files=[r.file])}),r.upload=function(e){if(e&&e.length)for(var t=0;t<e.length;t++){var n=e[t];n.$error||o.upload({url:"/api/upload-image",data:{file:n,chequeID:r.chequeID,username:a.user.principal.username}}).success(function(){c.getPhotoListFromServer(r.chequeID)})}}}]).directive("photoBlock",[function(){return{restrict:"E",controller:"PhotoBlock",scope:{chequeID:"=chequeId"},require:"chequeId",templateUrl:"app/cheque-page/photo-block/photo-block.html"}}]),angular.module("mainModule").controller("FilterForm",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$q","cheque","autocomplete",function(e,t,n,r,o,a,i,c,u){t.filterForm={},t.getAutocompleteData=u.getAutocompleteData,t.getExcelAnalytics=c.getExcelAnalytics,t.resetFilter=function(){e.filter=angular.copy({}),t.filterForm.$setPristine()},t.sendFilterPreferences=function(){e.tableFilter.page=1,e.currentFilter=angular.copy(e.filter),c.getChequeListFromServer()}}]).directive("filterForm",function(){return{restrict:"E",controller:"FilterForm",templateUrl:"app/filters-page/filter-form/filter-form.html"}}),angular.module("mainModule").filter("filterByDateRange",function(){return function(e,t,n){if(null==t&&null==n)return e;var r,o=(null!=t?moment(t):moment("1899-12-31T21:00:00.000Z")).unix(),a=(null!=n?moment(n):moment("2999-12-31T21:00:00.000Z")).unix(),i=[];return angular.forEach(e,function(e){r=moment(e.receiptDate).unix(),o<r&&r<a&&i.push(e)}),i}}),angular.module("mainModule").filter("filterByID",function(){return function(e,t){if(null==t||""==t)return e;var n=[];return angular.forEach(e,function(e){t==e.id&&n.push(e)}),n}}),angular.module("mainModule").controller("TableData",["$rootScope","$scope","$http","$timeout","$mdDialog","gettextCatalog","$state","cheque",function(e,t,n,r,o,a,i,c){t.label={page:"Страница",rowsPerPage:a.getString("Rows per page:"),of:a.getString("of")},t.mdOnPaginate=c.getChequeListFromServer,t.mdOnReorder=c.getChequeListFromServer,t.open=function(e,t){(2===e.which||1===e.which&&(e.metaKey||e.ctrlKey))&&window.open(i.href("cheque.edit",{chequeId:t},{absolute:!0}),"_blank")}}]).directive("tableData",function(){return{restrict:"E",controller:"TableData",templateUrl:"app/filters-page/table-data/table-data.html"}}),angular.module("mainModule").controller("CurrencyRateDay",["$scope","$http",function(e,t){e.sendRate=function(){t.post("/api/currency-rate",e.rate).success(function(){e.day.$setPristine()})}}]).directive("currencyRateDay",function(){return{restrict:"E",controller:"CurrencyRateDay",scope:{rate:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/currency-rate-day/currency-rate-day.html"}}),angular.module("mainModule").controller("UserDetails",["$scope","$http","currencyRatesService",function(e,t,n){e.saveUser=function(){t.post("/api/user",e.user).success(function(){e.$parent.getUsers()})},e.addAuthority=function(e){return{authority:e}}}]).directive("userDetails",function(){return{restrict:"E",controller:"UserDetails",scope:{user:"=ngModel"},require:"ngModel",templateUrl:"app/profile-page/user-details/user-details.html"}}),angular.module("mainModule").controller("PaymentLine",["$scope","security","autocomplete",function(n,e,t){n.hasPrepayment=!1,n.types=["repair","zip","deliver","prepayment"],n.currencies=["eur","uah","usd","rub"],n.security=e,n.users=[],n.getUsers=function(){t.getUsers().then(function(e){n.users=e})},n.getUsers(),n.$watch("payment.type",function(e,t){n.hasPrepayment="prepayment"===e}),n.$watch("paid",function(e,t){n.paymentLineDisabled=e||!n.security.hasAnyRole(["ROLE_ADMIN","ROLE_BOSS"])&&!n.security.isSameUser(n.payment.user)}),n.toPay=function(e){return n.payment.cost*n.payment.exchangeRate[n.payment.currency]/n.payment.exchangeRate[e]}}]).directive("paymentLine",[function(){return{restrict:"E",controller:"PaymentLine",scope:{payment:"=payment",paid:"=paid"},require:["ngModel","paid"],templateUrl:"app/cheque-page/payment-block/payment-line/payment-line.html"}}]),angular.module("mainModule").controller("DatePicker",["$scope",function(n){n.$watch("date",function(e,t){n.dateInner=null==e?void 0:moment(e).toDate()}),n.$watch("dateInner",function(e,t){null!=e&&(n.date=moment(e).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("datePicker",function(){return{restrict:"E",controller:"DatePicker",scope:{date:"=ngModel",disabled:"=ngDisabled",placeholder:"=mdPlaceholder"},require:["ngModel","ngDisabled"],templateUrl:"directives/date-picker/date-picker.html"}}),angular.module("mainModule").controller("DateTimePicker",["$scope",function(o){o.$watch("datetime",function(e,t){null==e?(o.datetimeinner=void 0,o.date=void 0,o.time=void 0):(o.date=moment(e).toDate(),o.time=moment(e).toDate())}),o.$watch("date",function(e,t){var n,r;null!=e&&(n=moment(o.datetime).hours(),r=moment(o.datetime).minutes(),o.datetime=moment(e).hours(n).minutes(r).format("YYYY-MM-DDTHH:mm:ssZZ"))}),o.$watch("time",function(e,t){var n;null!=e&&(n=moment(e).hours(),e=moment(e).minutes(),o.datetime=moment(o.datetime).hours(n).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("dateTimePicker",function(){return{restrict:"E",controller:"DateTimePicker",scope:{datetime:"=ngModel",disableChequeForm:"=ngDisabled"},require:"ngModel",templateUrl:"directives/date-time-picker/date-time-picker.html"}}),angular.module("mainModule").controller("TimePicker",["$scope",function(n){n.$watch("time",function(e,t){null==e?(n.hours=void 0,n.minutes=void 0):(n.hours=moment(e).format("HH"),n.minutes=moment(e).format("mm"))}),n.$watch("hours",function(e,t){null!=e&&(n.time=moment(n.time).hours(e).format("YYYY-MM-DDTHH:mm:ssZZ"))}),n.$watch("minutes",function(e,t){null!=e&&(n.time=moment(n.time).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("timePicker",function(){return{restrict:"E",controller:"TimePicker",scope:{time:"=ngModel"},require:"ngModel",templateUrl:"directives/time-picker/time-picker.html"}}),angular.module("mainModule").factory("auth",["$rootScope","$http","$state","$q",function(r,o,a,i){var c={authenticated:!(r.user={}),loginState:"cheque.login",logoutPath:"/logout",desireState:"cheque.filter",desireParams:{},init:function(){c.authenticate({},{}).then(function(e){e||a.go(c.loginState)}),r.$on("$stateChangeStart",function(e,t,n,r,o){t.name===c.loginState||c.authenticated||(c.desireState=t.name,c.desireParams=n,e.preventDefault())})},authenticate:function(e,t){var n=i.defer(),e=e&&e.username?{Authorization:"Basic "+btoa(e.username+":"+e.password)}:{};return e.ReCaptcha=t,o.get("/api/user",{headers:e,params:{"remember-me":!0}}).success(function(e){r.user=e,c.authenticated=!!e.name,a.go(c.desireState,c.desireParams),n.resolve(c.authenticated)}).error(function(){n.resolve(!1),c.authenticated=!1}),n.promise},logout:function(){o.post(c.logoutPath,{}),c.authenticated=!1,r.user={},a.go(c.loginState)}};return c}]),angular.module("mainModule").factory("autocomplete",["$rootScope","$http","$q",function(e,r,o){return{getUsers:function(){var t=o.defer();return r.get("/api/users").success(function(e){t.resolve(e)}),t.promise},getAutocompleteData:function(e,t){if(!(void 0===arguments[2]||arguments[2]))return[];var n=o.defer();return r.get("/api/autocomplete/"+e+"/"+t).success(function(e){n.resolve(e)}),n.promise}}}]),angular.module("mainModule").factory("cheque",["$rootScope","$http","$state","$q","warning","$mdToast","gettextCatalog","_","FileSaver",function(r,o,t,a,e,i,c,n,u){return r.cheque={},r.balance={payments:[]},r.photoList=[],r.filter={customerName:null,engineer:null,model:null,phoneNumber:null,productName:null,representativeName:null,secretary:null,serialNumber:null},r.currentFilter={},r.page={},{createNewCheque:function(){o.get("/api/test"),r.cheque={repairPeriod:99,receiptDate:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),components:[],notes:[],diagnostics:[],balance:{paidStatus:!1},secretary:r.user.principal,engineer:r.user.principal},r.balance={payments:[]},r.photoList=[]},getChequeListFromServer:function(){var e={page:r.tableFilter.page-1,size:r.tableFilter.size,sort:(-1!==(e=r.tableFilter.sort).indexOf("-")?(e=e.substr(1),e+=",desc"):e+=",asc",e)},t=n.omitBy(r.currentFilter,n.isEmpty);o.post("/api/cheques/list",t,{params:e}).success(function(e){r.page=e})},getChequeFromServer:function(e){o.get("/api/cheques/"+e).success(function(e){r.cheque=e})},deleteChequeFromServer:function(e){o.delete("/api/cheques/"+e).success(function(){t.go("cheque.filter"),i.show(i.simple().content(c.getString("Cheque")+" №"+e+" "+c.getString("deleted")).position("top right").hideDelay(7e3))})},syncChequeWithServer:function(e){var t=a.defer();return o.post("/api/cheques",e).success(function(e){r.cheque=e,t.resolve(!0),i.show(i.simple().content(c.getString("Cheque")+" "+c.getString("synchronized")).position("top right").hideDelay(700))}).error(function(){t.resolve(!1)}),t.promise},getDiagnosticsFromServer:function(e){o.get("/api/cheques/"+e+"/diagnostics").then(function(e){r.cheque.diagnostics=e.data})},getNotesFromServer:function(e){o.get("/api/cheques/"+e+"/notes").then(function(e){r.cheque.notes=e.data})},getChequeBalanceFromServer:function(e){o.get("/api/balance/cheque/"+e).success(function(e){r.balance=e}).error(function(){r.balance={}})},syncChequeBalanceWithServer:function(e,t){var n=a.defer();return o.post("/api/balance/cheque/"+e,t).success(function(e){n.resolve(!0),r.balance=e,i.show(i.simple().content(c.getString("payments synchronized")).position("top right").hideDelay(700))}).error(function(){n.resolve(!1)}),n.promise},getPhotoListFromServer:function(e){o.get("/api/photo/cheque/"+e).success(function(e){r.photoList=e})},deletePhotoFromServer:function(e){o.delete("api/photo/"+e)},addToChequeCurrentDateIfEmpty:function(e,t){r.cheque.hasOwnProperty(e)&&!0===r.cheque[t]?r.cheque[e]=moment().format("YYYY-MM-DDTHH:mm:ssZZ"):r.cheque[e]=void 0},cleanDateIfOff:function(e,t){r.cheque.hasOwnProperty(e)&&!0===r.cheque[t]||(r.cheque[e]=void 0)},getExcelAnalytics:function(){var e=n.omitBy(r.currentFilter,n.isEmpty);o.post("/api/analytics",e,{responseType:"blob"}).success(function(e){e=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});u.saveAs(e,"analytics.xlsx")})}}}]),angular.module("mainModule").service("currencyRatesService",["CacheFactory","$http","$q","$rootScope",function(e,n,r,t){var o;return e.get("currencyRatesCache")||e.createCache("currencyRatesCache",{deleteOnExpire:"aggressive",maxAge:288e5,recycleFreq:6e4,storageMode:"localStorage",onExpire:function(t,e){n.get(t).success(function(e){o.put(t,e)})}}),o=e.get("currencyRatesCache"),{getCurrencyRate:function(){n.get("/api/currency-rate",{cache:o}).success(function(e){t.currencyRates=e})},refreshCurrencyRate:function(){o.remove("/api/currency-rate"),this.getCurrencyRate()},getListOfCurrencyRates:function(){var t=r.defer();return n.get("/api/currency-rate-list").success(function(e){t.resolve(e)}),t.promise},setListOfCurrencyRates:function(e){n.post("/api/currency-rate-list",e)}}}]),angular.module("mainModule").service("security",["$rootScope","$http","$location","$state",function(r,e,t,i){return{init:function(){var a=this.hasAnyRole;r.$on("$stateChangeStart",function(e,t,n,r,o){t.data.access&&(a(t.data.access)||(e.preventDefault(),i.go("cheque.filter")))})},hasRole:function(t){var n=!1;return angular.forEach(r.user.authorities,function(e){e.authority===t&&(n=!0)}),n},hasAnyRole:function(e){var n=!1;return angular.forEach(r.user.authorities,function(t){angular.forEach(e,function(e){t.authority===e&&(n=!0)})}),n},isSameUser:function(e){return r.user.principal.username===e.username}}}]),angular.module("mainModule").factory("warning",["$rootScope","$http","$state","$mdDialog","gettextCatalog",function(e,t,n,r,o){return{showConfirmUnsavedChanges:function(e){var t=r.confirm().title(o.getString("would you like to continue without saving changes?")).textContent(o.getString("if you do not save your changes, then all the information will be lost")).ariaLabel("unsaved changes warning").targetEvent(void 0).ok(o.getString("continue")).cancel(o.getString("cancel"));return r.show(t)},showConfirmDeletePayment:function(e){e=r.confirm().title(o.getString("would you like to delete payment?")).textContent(o.getString("deleted payment can not be recovered")).ariaLabel("delete payment warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(e)},showConfirmDeleteComment:function(e){e=r.confirm().title(o.getString("would you like to delete comment?")).textContent(o.getString("deleted comment can not be recovered")).ariaLabel("delete comment warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(e)},showConfirmDeleteCheque:function(e){e=r.confirm().title(o.getString("would you like to delete cheque?")).textContent(o.getString("deleted cheque can not be recovered")).ariaLabel("delete cheque warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(e)},showConfirmDeletePhoto:function(e){e=r.confirm().title(o.getString("would you like to delete photo?")).textContent(o.getString("deleted photo can not be recovered")).ariaLabel("delete photo warning").targetEvent(e).ok(o.getString("delete")).cancel(o.getString("cancel"));return r.show(e)},showAlertOptimisticLockingException:function(){var e=r.alert().clickOutsideToClose(!0).title(o.getString("cheque has been changed")).textContent(o.getString("cheque has been changed by another user, please refresh the cheque and enter your changes again.")).ariaLabel("optimistic locking exception").ok(o.getString("ok"));return r.show(e)},showServerConnectionLostException:function(){var e=r.alert().clickOutsideToClose(!1).title(o.getString("server connection lost title")).textContent(o.getString("server connection lost content")).ariaLabel("server connection lost").ok(o.getString("ok"));return r.show(e)},showServerSessionExpired:function(){var e=r.alert().clickOutsideToClose(!1).title(o.getString("server session expired title")).textContent(o.getString("server session expired content")).ariaLabel("server session expired").ok(o.getString("ok"));return r.show(e)}}}]),angular.module("gettext").run(["gettextCatalog",function(e){e.setStrings("ru",{Address:"Address","Change cheque №":"Изменить расписку №",notes:"Специальные отметки","new cheques":"Новые расписки",Customer:"Заказчик",Email:"Почта",Guarantee:"Гарантия (д/н)",help:"Помощь",Home:"Главная",Id:"№",Inspector:"Принял",Introduced:"Прием","Introduced From":"Принят с","Introduced To":"Принят по",Issued:"Выдан (д/н)","Is Issued":"Выдан",Kits:"Комплект",Malfunction:"Неисправность",Master:"Инженер",Model:"Модель","Modify Check":"Править","Name of Product":"Наименование",No:"Нет","Number of pages":"Количество страниц",Phone:"Телефон",profile:"Профиль",Purchaser:"Сдал",Ready:"Готов (д/н)","Is Ready":"Готов","Repair Period":"Срок ремонта",Send:"Добавить","Serial Number":"Серийный номер",settings:"Настройки","Special Notes":"Особые отметки",diagnostics:"Диагностика",Yes:"Да",Filters:"Фильтры",Checks:"Расписки",Create:"Создать","Change cheque":"Изменить расписку",Now:"Сейчас",Cancel:"Закрыть",save:"Применить",Cheque:"Расписка",added:"добавлена",modified:"изменена",deleted:"удалена","Has guarantee":"Есть гарантия",Warranty:"Гарантия","Has no guarantee":"Нет гарантии","Not ready":"Не готов","Not issued":"Не выдан","Rows per page:":"Строк на странице:",of:"из",tasks:"Задачи",login:"Войти",logout:"Выйти",analytics:"Аналитика",synchronize:"Синхронизировать",synchronized:"синхронизирована","enter date":"Введите дату",cheque:"Расписка",Paid:"Оплачен (д/н)","Is Paid":"Оплачен","Not Paid":"Не оплачен",payment:"Оплата",repair:"Ремонт",zip:"ЗИП",deliver:"Доставка",prepayment:"Предоплата",type:"Тип",description:"Описание",cost:"Стоимость",currency:"Валюта",sum:"Сумма","sum with prepayment":"Осталось оплатить","estimated cost":"Ориентировочная цена","currency rates":"Курс валют","show more":"Показать ещё","roll up":"Свернуть",Authorization:"Авторизация",Username:"Логин",Password:"Пароль",Users:"Пользователи","cheques with delay":"Расписки с просрочкой","New Cheque":"Новая расписка",photographies:"Фотографии","drop photographies here":"Поместите фотографии сюда","would you like to continue without saving changes?":"Выйти без сохранения изменений?","if you do not save your changes, then all the information will be lost":"Если не сохранить изменения, то вся информация будет потеряна",continue:"Продолжить",cancel:"Отмена","would you like to delete payment?":"Удалить счет?","deleted payment can not be recovered":"Удаленный счет невозможно восстановить",delete:"Удалить","would you like to delete comment?":"Удалить комментарий?","deleted comment can not be recovered":"Удаленный комментарий невозможно восстановить","would you like to delete cheque?":"Удалить расписку?","deleted cheque can not be recovered":"Удаленную расписку невозможно восстановить","would you like to delete photo?":"Удалить фото?","deleted photo can not be recovered":"Удаленное фото невозможно восстановить","payments synchronized":"Оплата синхронизирована","cheque has been changed":"Расписка была изменена другим пользователем","cheque has been changed by another user, please refresh the cheque and enter your changes again.":"Пожалуйста, обновите расписку и внесите свои изменения снова",find:"Найти",Fullname:"Полное имя","New password":"Новый пароль","Admin password":"Пароль администратора",enabled:"Включен","server connection lost title":"Соединение с сервером потеряно","server connection lost content":"Случилось страшное: сервер не отвечает на запросы. Попробуйте обновить страницу через несколько минут.","server session expired title":"Сессия с сервером устарела","server session expired content":"Случилось страшное: сессия с сервером устарела. Перезайдите!",receipt:"принята","Returned From":"Выдан с","Returned To":"Выдан по","Without Repair":"Без ремонта (д/н)","Is Without Repair":"Без ремонта","With Repair":"С ремонтом",administration:"Управление"})}]);